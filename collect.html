<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Global Monarchs Collector</title>
  <style>
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background: #f7f9fb;
      margin: 0;
      padding: 0;
      color: #222;
    }

    header {
      background: #1a73e8;
      color: #fff;
      padding: 1.2rem 2rem;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    #controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem;
    }

    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1rem;
      cursor: pointer;
      font-size: 0.95rem;
      transition: background 0.2s;
    }

    button:hover {
      background-color: #155fc7;
    }

    #progress {
      text-align: center;
      font-size: 0.95rem;
      color: #333;
      margin-bottom: 1rem;
    }

    #output {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }

    .country-card {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      height: 500px;
    }

    .country-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .country-name {
      font-weight: 600;
      font-size: 1.1rem;
      color: #1a73e8;
    }

    .scrollbox {
      background: #f3f6fa;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 0.6rem;
      overflow-y: auto;
      white-space: pre-wrap;
      flex-grow: 1;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .scrollbox::-webkit-scrollbar {
      width: 6px;
    }

    .scrollbox::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 3px;
    }

    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.85rem;
      color: #666;
    }

    .btn-small {
      background-color: #34a853;
      padding: 0.4rem 0.7rem;
      font-size: 0.85rem;
    }

    .btn-small:hover {
      background-color: #2c8b46;
    }

    .btn-red {
      background-color: #ea4335;
    }

    .btn-red:hover {
      background-color: #c13a2e;
    }
  </style>
</head>
<body>
  <header>
    <h1>Global Monarchs Collector (Wikipedia Full Text)</h1>
  </header>

  <section id="controls">
    <button id="fetchAllBtn">Fetch All Countries</button>
    <button id="copyAllBtn" class="btn-small">Copy All</button>
    <button id="downloadBtn" class="btn-small">Download JSON</button>
  </section>

  <div id="progress">Idle – ready to begin.</div>

  <main id="output"></main>

  <footer>© 2025 Monarch Data Collector | Wikipedia API</footer>

  <script>
    /* ✅ PART 2 – JavaScript (Countries List + Core Functions) */

const countries = [
  "Afghanistan","Albania","Algeria","Andorra","Angola","Antigua and Barbuda",
  "Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain",
  "Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia",
  "Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso",
  "Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic",
  "Chad","Chile","China","Colombia","Comoros","Congo, Republic of the",
  "Congo, Democratic Republic of the","Costa Rica","Côte d’Ivoire","Croatia",
  "Cuba","Cyprus","Czech Republic","Denmark","Djibouti","Dominica",
  "Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea",
  "Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon",
  "Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea",
  "Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India",
  "Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan",
  "Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon",
  "Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg",
  "Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands",
  "Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia",
  "Montenegro","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal",
  "Netherlands","New Zealand","Nicaragua","Niger","Nigeria","North Korea",
  "North Macedonia","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea",
  "Paraguay","Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia",
  "Rwanda","Saint Kitts and Nevis","Saint Lucia",
  "Saint Vincent and the Grenadines","Samoa","San Marino","São Tomé and Príncipe",
  "Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore",
  "Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea",
  "South Sudan","Spain","Sri Lanka","Sudan","Suriname","Sweden","Switzerland",
  "Syria","Tajikistan","Tanzania","Thailand","Timor-Leste","Togo","Tonga",
  "Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Tuvalu","Uganda",
  "Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay",
  "Uzbekistan","Vanuatu","Vatican City","Venezuela","Vietnam","Yemen","Zambia",
  "Zimbabwe"
];

// Store results
let allResults = {};

// Create UI card for each country
function createCountryCard(country) {
  const container = document.createElement("div");
  container.className = "country-card";

  container.innerHTML = `
    <div class="country-header">
      <span class="country-name">${country}</span>
      <button class="btn-small copy-btn" data-country="${country}">Copy</button>
    </div>
    <div id="box-${country}" class="scrollbox">Fetching...</div>
  `;
  document.getElementById("output").appendChild(container);
}

// Fetch Wikipedia text for country (Kings/Monarchs related page)
async function fetchKingsForCountry(country) {
  try {
    // Common page name format
    const title = `List of monarchs of ${country}`;
    const url = `https://en.wikipedia.org/w/api.php?action=query&prop=extracts&explaintext&titles=${encodeURIComponent(title)}&format=json&origin=*`;

    const response = await fetch(url);
    const data = await response.json();

    const pages = data.query.pages;
    const page = pages[Object.keys(pages)[0]];

    if (!page || page.missing) {
      return "No data found on Wikipedia.";
    }

    return cleanText(page.extract);
  } catch (e) {
    return "Error fetching data.";
  }
}

// Clean text before display
function cleanText(text) {
  return text
    .replace(/==+/g, "\n")    // convert headings to spacing
    .replace(/\n{2,}/g, "\n") // remove repeated line breaks
    .trim();
}
/* ✅ PART 3 – Copy / Download / Fetch Workflow */

// Update one card
async function updateCountryCard(country, index) {
  const box = document.getElementById(`box-${country}`);
  box.textContent = "Fetching data from Wikipedia…";
  document.getElementById("progress").textContent =
    `(${index + 1}/${countries.length}) Fetching: ${country}`;

  const resultText = await fetchKingsForCountry(country);
  box.textContent = resultText;

  allResults[country] = {
    country,
    fullText: resultText
  };
}

// Fetch all countries sequentially
async function fetchAllCountries() {
  document.getElementById("progress").textContent = "Starting global fetch…";
  allResults = {};
  document.getElementById("output").innerHTML = "";
  for (let i = 0; i < countries.length; i++) {
    createCountryCard(countries[i]);
    await updateCountryCard(countries[i], i);
  }
  document.getElementById("progress").textContent = "✅ All countries fetched!";
}

// Copy one country
function copyCountryText(country) {
  const text = allResults[country]?.fullText || "";
  if (text) {
    navigator.clipboard.writeText(text);
    alert(`Copied text for ${country}`);
  } else {
    alert(`No text available for ${country}`);
  }
}

// Copy all countries
function copyAll() {
  const allText = Object.entries(allResults)
    .map(([c, d]) => `=== ${c} ===\n${d.fullText}`)
    .join("\n\n");
  navigator.clipboard.writeText(allText);
  alert("All text copied to clipboard!");
}

// Download JSON file
function downloadJSON() {
  const blob = new Blob([JSON.stringify(allResults, null, 2)], {
    type: "application/json",
  });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "monarchs_data.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Event bindings
document.getElementById("fetchAllBtn").addEventListener("click", fetchAllCountries);
document.getElementById("copyAllBtn").addEventListener("click", copyAll);
document.getElementById("downloadBtn").addEventListener("click", downloadJSON);

// Handle dynamic copy buttons
document.addEventListener("click", (e) => {
  if (e.target.classList.contains("copy-btn")) {
    const country = e.target.dataset.country;
    copyCountryText(country);
  }
});
</script>
</body>
</html>

