<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Monarch Collector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f2f2f2;
            padding: 20px;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            max-height: 500px;
            overflow-y: auto;
        }
        pre {
            background: #222;
            color: #0f0;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>

    <h1>World Monarchs Collector</h1>
    <button onclick="start()">Start Fetching</button>
    <button onclick="copyData()">Copy JSON</button>
    <button onclick="downloadData()">Download JSON</button>

    <div id="output"></div>

    <script>
        const countries = [
            "Afghanistan","Albania","Algeria","Andorra","Angola","Antigua and Barbuda","Argentina","Armenia","Australia",
            "Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan",
            "Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde",
            "Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia","Comoros",
            "Congo, Republic of the","Congo, Democratic Republic of the","Costa Rica","Côte d’Ivoire","Croatia","Cuba",
            "Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador",
            "Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia",
            "Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary",
            "Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan",
            "Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein",
            "Lithuania","Luxembourg","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands",
            "Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Morocco","Mozambique",
            "Myanmar","Namibia","Nauru","Nepal","Netherlands","New Zealand","Nicaragua","Niger","Nigeria","North Korea",
            "North Macedonia","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea","Paraguay","Peru","Philippines",
            "Poland","Portugal","Qatar","Romania","Russia","Rwanda","Saint Kitts and Nevis","Saint Lucia",
            "Saint Vincent and the Grenadines","Samoa","San Marino","São Tomé and Príncipe","Saudi Arabia","Senegal","Serbia",
            "Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa",
            "South Korea","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Sweden","Switzerland","Syria","Tajikistan",
            "Tanzania","Thailand","Timor-Leste","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan",
            "Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay","Uzbekistan",
            "Vanuatu","Vatican City","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe"
        ];

        const resultData = [];

        async function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function fetchWikiPage(title) {
            try {
                const url = `https://en.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(title)}&prop=text&format=json&origin=*`;
                const response = await fetch(url);
                const data = await response.json();
                return data.parse ? data.parse.text["*"] : null;
            } catch {
                return null;
            }
        }

        function extractLinks(html) {
            const div = document.createElement("div");
            div.innerHTML = html;
            return [...div.querySelectorAll("a[href^='/wiki/']")].map(a => ({
                name: a.getAttribute("title"),
                url: "https://en.wikipedia.org" + a.getAttribute("href")
            })).filter(l => l.name);
        }

        async function fetchBiography(name) {
            const html = await fetchWikiPage(name);
            if (!html) return "No data available.";

            const div = document.createElement("div");
            div.innerHTML = html;
            return div.innerText.replace(/\[.*?\]/g, "").replace(/\s+/g, " ").trim();
        }

        async function processCountry(country) {
            const listTitle = `List of monarchs of ${country}`;
            const html = await fetchWikiPage(listTitle);
            if (!html) return;

            const links = extractLinks(html).slice(0, 10);
            const monarchs = [];

            for (const item of links) {
                const bio = await fetchBiography(item.name);
                monarchs.push({ name: item.name, url: item.url, biography: bio });
                await delay(2000);
            }

            resultData.push({ country, monarchs });
            displayCountry(country, monarchs);
        }

        function displayCountry(country, monarchs) {
            const output = document.getElementById("output");
            const div = document.createElement("div");
            div.innerHTML = `<h3>${country}</h3>`;
            monarchs.forEach(m =>
                div.innerHTML += `<p><strong>${m.name}:</strong> ${m.biography.substring(0, 200)}...</p>`
            );
            output.appendChild(div);
        }

        async function start() {
            for (const country of countries) {
                await processCountry(country);
            }
        }

        function copyData() {
            navigator.clipboard.writeText(JSON.stringify(resultData, null, 2));
            alert("Copied!");
        }

        function downloadData() {
            const blob = new Blob([JSON.stringify(resultData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'monarchs.json';
            link.click();
        }
    </script>

</body>
</html>
