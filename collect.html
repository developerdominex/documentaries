<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>King & Queen Data Collector</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      color: #333;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      background-color: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background-color: #0056b3;
    }
    pre {
      background: #222;
      color: #fff;
      padding: 15px;
      border-radius: 5px;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 500px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

<h1>Collect Kings & Queens (First 5 Countries)</h1>
<button id="startBtn">Start Collecting</button>
<button id="copyBtn">Copy JSON</button>
<button id="downloadBtn">Download JSON</button>

<h2>Collected Data:</h2>
<pre id="output">Click "Start Collecting" to begin...</pre>

<script>
const countries = ["Antigua and Barbuda","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh"];
let finalData = {};

async function fetchKingsFromCountry(country) {
  const searchTitle = `List of monarchs of ${country}`;
  const url = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(searchTitle)}&format=json&origin=*`;

  const res = await fetch(url);
  const data = await res.json();

  if (!data.query.search.length) return [];

  const pageTitle = data.query.search[0].title;
  const pageUrl = `https://en.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(pageTitle)}&format=json&origin=*`;

  const pageRes = await fetch(pageUrl);
  const pageData = await pageRes.json();

  if (!pageData.parse || !pageData.parse.text) return [];

  const htmlContent = pageData.parse.text["*"];
  const div = document.createElement("div");
  div.innerHTML = htmlContent;

  let links = Array.from(div.querySelectorAll("a"))
    .map(a => a.title)
    .filter(title => title && !title.includes(":"));

  return [...new Set(links)].slice(0, 10); // limit to first 10 names
}

async function fetchBiography(name) {
  const url = `https://en.wikipedia.org/w/api.php?action=query&prop=extracts&exintro&explaintext&titles=${encodeURIComponent(name)}&format=json&origin=*`;
  const res = await fetch(url);
  const data = await res.json();
  const page = data.query.pages[Object.keys(data.query.pages)[0]];
  return page.extract || "No biography available";
}

async function startCollection() {
  finalData = {};
  document.getElementById("output").textContent = "Fetching data... Please wait.";

  for (const country of countries) {
    finalData[country] = [];
    const kings = await fetchKingsFromCountry(country);

    for (const king of kings) {
      const bio = await fetchBiography(king);
      finalData[country].push({ name: king, biography: bio });
    }
  }

  document.getElementById("output").textContent = JSON.stringify(finalData, null, 2);
}

function copyJSON() {
  navigator.clipboard.writeText(JSON.stringify(finalData, null, 2));
  alert("JSON copied to clipboard!");
}

function downloadJSON() {
  const blob = new Blob([JSON.stringify(finalData, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "kings_and_queens.json";
  a.click();
  URL.revokeObjectURL(url);
}

document.getElementById("startBtn").addEventListener("click", startCollection);
document.getElementById("copyBtn").addEventListener("click", copyJSON);
document.getElementById("downloadBtn").addEventListener("click", downloadJSON);
</script>

</body>
</html>
